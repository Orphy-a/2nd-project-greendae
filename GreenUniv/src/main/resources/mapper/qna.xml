<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.greenuniv.greenuniv.dao.mapper.QnaMapper">
  <resultMap id="qnaMap" type="com.greenuniv.greenuniv.dto.article.QnaDTO">
    <association property="reply"
      resultMap="com.greenuniv.greenuniv.dao.mapper.ArticleMapper.articleMap"/>
    <association property="question"
      resultMap="com.greenuniv.greenuniv.dao.mapper.ArticleMapper.articleMap"
      columnPrefix="question_"/>
  </resultMap>

  <select id="selectLimit" resultMap="qnaMap">
    SELECT
    `q_artcl`.id AS `question_article_id`,
    `q_artcl`.title AS `question_article_title`,
    `q_artcl`.category AS `question_article_category`,
    `q_artcl`.`status` AS `question_article_status`,
    `q_artcl`.content AS `question_article_content`,
    `q_artcl`.`view` AS `question_article_view`,
    `artcl`.id AS `article_id`,
    `artcl`.title AS `article_title`,
    `artcl`.category AS `article_category`,
    `artcl`.`status` AS `article_status`,
    `artcl`.content AS `article_content`,
    `artcl`.`view` AS `article_view`,
    `qna`.is_private,
    `qna`.`password` AS `qna_password`,
    `user`.id AS `user_id`,
    `user`.`name` AS `user_name`
    FROM `qna`
    JOIN `article` AS `artcl`
    ON `qna`.answer_id = `artcl`.id
    JOIN `article` AS `q_artcl`
    ON `qna`.question_id = `q_artcl`.id
    JOIN `user`
    ON `user`.id = `artcl`.user_id
    ORDER BY `artcl`.register_date DESC
    LIMIT #{limit} OFFSET #{offset};
  </select>

  <select id="selectByLimit" resultMap="qnaMap">
    SELECT
    `q_artcl`.id AS `question_article_id`,
    `q_artcl`.title AS `question_article_title`,
    `q_artcl`.category AS `question_article_category`,
    `q_artcl`.`status` AS `question_article_status`,
    `q_artcl`.content AS `question_article_content`,
    `q_artcl`.`view` AS `question_article_view`,
    `artcl`.id AS `article_id`,
    `artcl`.title AS `article_title`,
    `artcl`.category AS `article_category`,
    `artcl`.`status` AS `article_status`,
    `artcl`.content AS `article_content`,
    `artcl`.`view` AS `article_view`,
    `qna`.is_private,
    `qna`.`password` AS `qna_password`,
    `user`.id AS `user_id`,
    `user`.`name` AS `user_name`
    FROM `qna`
    JOIN `article` AS `artcl`
    ON `qna`.answer_id = `artcl`.id
    JOIN `article` AS `q_artcl`
    ON `qna`.question_id = `q_artcl`.id
    JOIN `user`
    ON `user`.id = `artcl`.user_id
    WHERE ${colName}=#{value}
    ORDER BY `artcl`.register_date DESC
    LIMIT #{limit} OFFSET #{offset};
  </select>

  <select id="count" resultType="long">
    SELECT
    COUNT(`question_id`) AS `qna_count`
    FROM `qna`;
  </select>
</mapper>
